commit_msg=$(cat "$1")

# Allow merge commits (they don't follow conventional commit format)
if [[ "$commit_msg" =~ ^[Mm]erge ]]; then
  exit 0
fi

# Conventional commit pattern: type(scope)?: subject
pattern="^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\([a-z0-9-]+\))?: .{1,100}$"

if [[ ! "$commit_msg" =~ $pattern ]]; then
  echo "Invalid commit message:"
  echo "  $commit_msg"
  echo ""
  echo "Format: type(scope?): subject"
  echo "  Types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert"
  echo "  Examples:"
  echo "    feat: add dark mode"
  echo "    fix(api): resolve rate limiting"
  echo "    docs: update README"
  echo ""
  echo "See: https://www.conventionalcommits.org/en/v1.0.0/"
  exit 1
fi
